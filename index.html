<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Critical for mobile -->
    <title>Start-Up Manifesto</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- HTML2Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        canvas {
            touch-action: none; 
            cursor: crosshair;
        }

        /* Image Editor Styles */
        .grab-cursor {
            cursor: grab;
        }
        .grab-cursor:active {
            cursor: grabbing;
        }

        /* RESPONSIVE DIMENSIONS:
           Mobile: Auto height (scrollable), 100% width.
           Desktop (md+): Fixed A4 Landscape dimensions.
        */
        .manifesto-container {
            width: 100%;
            background-color: white;
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .manifesto-container {
                max-width: 297mm;
                min-height: 210mm;
                aspect-ratio: 297/210;
            }
        }
    </style>
</head>
<body class="bg-slate-900 min-h-screen p-4 flex flex-col items-center justify-start gap-6">

    <!-- Header / Intro -->
    <div class="text-center text-white mt-2 mb-2">
        <h1 class="text-xl md:text-2xl font-bold tracking-wider text-emerald-400">OUR MANIFESTO</h1>
        <p class="text-slate-400 text-xs md:text-sm">These are our non-negotiables</p>
    </div>

    <!-- MAIN MANIFESTO CARD -->
    <!-- On mobile, this is just a white column. On desktop, it becomes A4. -->
    <div id="manifesto-card" class="manifesto-container p-6 md:p-8 rounded-sm shadow-2xl flex flex-col mx-auto">
        
        <!-- Decorative Border -->
        <div class="absolute top-0 left-0 w-full h-3 bg-gradient-to-r from-slate-800 to-emerald-500"></div>
        <div class="absolute bottom-0 right-0 w-full h-2 bg-slate-100"></div>

        <!-- MAIN GRID LAYOUT -->
        <!-- Stack on mobile (grid-cols-1), Split on desktop (md:grid-cols-2) -->
        <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-10 h-full">
            
            <!-- LEFT COLUMN: BRAND IDENTITY -->
            <div class="flex flex-col h-full md:border-r md:border-slate-100 md:pr-6">
                <!-- Header -->
                <header class="mb-6 mt-2">
                    <h2 class="text-[10px] md:text-xs font-bold text-slate-500 tracking-[0.3em] uppercase mb-1">Official Document</h2>
                    <h1 class="text-3xl md:text-4xl font-black text-slate-800 tracking-tight leading-none">FOUNDERS<br>AGREEMENT</h1>
                </header>

                <!-- Start-Up Name -->
                <div class="mb-6 group">
                    <label class="block text-[10px] md:text-xs font-bold text-emerald-600 uppercase mb-1">Start-Up Name</label>
                    <input type="text" id="input-company" placeholder="NAME HERE" 
                        class="w-full text-3xl md:text-4xl font-bold text-slate-900 border-b-4 border-slate-200 focus:border-emerald-500 outline-none transition-colors py-1 placeholder-slate-300 bg-transparent uppercase">
                </div>

                <!-- Big Poster Area with Manual Crop/Pan -->
                <div class="flex-grow flex flex-col relative mb-4 md:mb-0 min-h-[250px]">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-[10px] md:text-xs font-bold text-slate-400 uppercase">Team Identity</label>
                        <!-- Image Controls (Hidden initially) -->
                        <div id="img-controls" class="hidden flex items-center gap-2">
                            <span class="text-[9px] text-slate-400 uppercase">Zoom</span>
                            <input type="range" id="zoom-slider" min="0.1" max="3" step="0.1" value="1" class="w-16 md:w-24 accent-emerald-500 h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                            <button id="change-img-btn" class="text-[9px] text-emerald-600 hover:text-emerald-800 font-bold uppercase ml-2 bg-slate-100 px-2 py-1 rounded">Change</button>
                        </div>
                    </div>

                    <!-- Drop Zone / Viewport -->
                    <div class="relative w-full flex-grow bg-slate-50 border-2 border-dashed border-slate-300 rounded-lg overflow-hidden flex flex-col items-center justify-center group hover:border-emerald-400 transition-colors h-full" id="image-drop-zone">
                        
                        <!-- File Input (Visible initially, hidden after upload) -->
                        <input type="file" id="poster-upload" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30">
                        
                        <!-- Placeholder Text -->
                        <div id="upload-placeholder" class="text-center p-4 pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 md:h-12 md:w-12 mx-auto text-slate-400 group-hover:text-emerald-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="text-xs md:text-sm font-medium text-slate-500 group-hover:text-emerald-600">Tap to Upload Poster</span>
                        </div>

                        <!-- The Image (Draggable) -->
                        <!-- Origin center allows logical zooming -->
                        <img id="poster-preview" class="absolute hidden z-20 grab-cursor origin-center" alt="Team Poster" style="transform: translate(0px, 0px) scale(1);">
                    </div>
                    <p id="drag-hint" class="hidden text-[9px] text-slate-300 text-center mt-1">Drag image to position â€¢ Use slider to zoom</p>
                </div>
            </div>

            <!-- RIGHT COLUMN: TERMS & EXECUTION -->
            <div class="flex flex-col h-full pt-1">
                
                <!-- 1. The Rules -->
                <div class="mb-6 md:mb-4">
                    <h3 class="text-xs md:text-sm font-bold text-slate-800 border-b border-slate-200 pb-2 mb-3 flex items-center gap-2">
                        <span class="bg-slate-800 text-white text-[10px] px-2 py-0.5 rounded">TERMS</span>
                        The 4 Golden Rules
                    </h3>
                    
                    <div class="flex flex-col gap-3 md:gap-2">
                        <!-- Rule 1 -->
                        <div class="flex flex-col md:flex-row md:items-start gap-1 md:gap-2">
                            <label class="md:w-24 text-[10px] font-bold text-emerald-600 uppercase md:text-right shrink-0 md:mt-2">Work Schedule</label>
                            <textarea id="input-rule1" rows="2" placeholder="Start time, end time..." class="w-full text-xs font-medium text-slate-700 bg-slate-50 p-2 rounded border border-slate-200 focus:ring-1 focus:ring-emerald-500 outline-none resize-none leading-tight"></textarea>
                        </div>
                        
                        <!-- Rule 2 -->
                        <div class="flex flex-col md:flex-row md:items-start gap-1 md:gap-2">
                            <label class="md:w-24 text-[10px] font-bold text-emerald-600 uppercase md:text-right shrink-0 md:mt-2">Location</label>
                            <textarea id="input-rule2" rows="2" placeholder="Remote? On site?" class="w-full text-xs font-medium text-slate-700 bg-slate-50 p-2 rounded border border-slate-200 focus:ring-1 focus:ring-emerald-500 outline-none resize-none leading-tight"></textarea>
                        </div>

                        <!-- Rule 3 -->
                        <div class="flex flex-col md:flex-row md:items-start gap-1 md:gap-2">
                            <label class="md:w-24 text-[10px] font-bold text-emerald-600 uppercase md:text-right shrink-0 md:mt-2">Comms Style</label>
                            <textarea id="input-rule3" rows="2" placeholder="WhatsApp? Slack?" class="w-full text-xs font-medium text-slate-700 bg-slate-50 p-2 rounded border border-slate-200 focus:ring-1 focus:ring-emerald-500 outline-none resize-none leading-tight"></textarea>
                        </div>

                        <!-- Rule 4 -->
                        <div class="flex flex-col md:flex-row md:items-start gap-1 md:gap-2">
                            <label class="md:w-24 text-[10px] font-bold text-emerald-600 uppercase md:text-right shrink-0 md:mt-2">Conflict Plan</label>
                            <textarea id="input-rule4" rows="2" placeholder="Majority vote?" class="w-full text-xs font-medium text-slate-700 bg-slate-50 p-2 rounded border border-slate-200 focus:ring-1 focus:ring-emerald-500 outline-none resize-none leading-tight"></textarea>
                        </div>
                    </div>
                </div>

                <!-- 2. The Signatures (Only 3) -->
                <div class="mt-auto pb-4">
                    <h3 class="text-xs md:text-sm font-bold text-slate-800 border-b border-slate-200 pb-2 mb-2">Founding Members Execution</h3>
                    
                    <div class="flex flex-col gap-3">
                        <!-- Sig 1 -->
                        <div class="flex items-center gap-3">
                            <div class="text-[9px] font-bold text-slate-400 uppercase w-12 md:w-16 text-right">Founder 1</div>
                            <div class="relative flex-grow">
                                <canvas id="sig1" width="250" height="55" class="bg-slate-50 border-b border-slate-300 w-full touch-none"></canvas>
                                <button onclick="clearPad('sig1')" class="absolute top-0 right-0 p-1 text-[8px] text-red-300 hover:text-red-500 font-bold">CLEAR</button>
                            </div>
                        </div>
                        <!-- Sig 2 -->
                        <div class="flex items-center gap-3">
                            <div class="text-[9px] font-bold text-slate-400 uppercase w-12 md:w-16 text-right">Founder 2</div>
                            <div class="relative flex-grow">
                                <canvas id="sig2" width="250" height="55" class="bg-slate-50 border-b border-slate-300 w-full touch-none"></canvas>
                                <button onclick="clearPad('sig2')" class="absolute top-0 right-0 p-1 text-[8px] text-red-300 hover:text-red-500 font-bold">CLEAR</button>
                            </div>
                        </div>
                        <!-- Sig 3 -->
                        <div class="flex items-center gap-3">
                            <div class="text-[9px] font-bold text-slate-400 uppercase w-12 md:w-16 text-right">Founder 3</div>
                            <div class="relative flex-grow">
                                <canvas id="sig3" width="250" height="55" class="bg-slate-50 border-b border-slate-300 w-full touch-none"></canvas>
                                <button onclick="clearPad('sig3')" class="absolute top-0 right-0 p-1 text-[8px] text-red-300 hover:text-red-500 font-bold">CLEAR</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="absolute bottom-2 left-8 right-8 text-center pointer-events-none">
            <p class="text-[9px] text-slate-300">Start-Up Manifesto App â€¢ Official Record â€¢ 2024 Cohort</p>
        </div>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="w-full max-w-md pb-10 mt-4 px-4">
        <button id="preview-btn" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
            Preview Manifesto
        </button>
        <p class="text-slate-500 text-xs text-center mt-2">Check your work before downloading!</p>
    </div>

    <!-- PREVIEW MODAL (Hidden by default) -->
    <div id="preview-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex flex-col items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white p-4 rounded-lg shadow-2xl max-w-4xl w-full flex flex-col gap-4 animate-in fade-in zoom-in duration-200">
            <div class="flex justify-between items-center border-b pb-2">
                <h2 class="text-lg md:text-xl font-bold text-slate-800">Preview Your Manifesto</h2>
                <button onclick="closePreview()" class="text-slate-400 hover:text-slate-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Image Container -->
            <div class="overflow-y-auto max-h-[60vh] md:max-h-[70vh] flex justify-center bg-slate-100 p-2 rounded border border-slate-200">
                <img id="final-preview-img" class="max-w-full h-auto shadow-md object-contain" alt="Preview">
            </div>

            <!-- Footer Buttons -->
            <div class="flex flex-col md:flex-row gap-3 justify-between items-center pt-2 w-full">
                <span class="text-[10px] text-slate-500 text-center md:text-left">ðŸ’¡ iOS Tip: If button fails, long-press the image to "Save to Photos"</span>
                <div class="flex gap-3 w-full md:w-auto justify-end">
                    <button onclick="closePreview()" class="px-4 py-2 rounded-lg font-bold text-slate-600 hover:bg-slate-100 border border-slate-200">Keep Editing</button>
                    <button id="save-final-btn" class="px-4 py-2 rounded-lg font-bold text-white bg-emerald-500 hover:bg-emerald-600 shadow flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Save Image
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. LOCAL STORAGE PERSISTENCE ---
        const inputIds = ['input-company', 'input-rule1', 'input-rule2', 'input-rule3', 'input-rule4'];

        document.addEventListener('DOMContentLoaded', () => {
            inputIds.forEach(id => {
                const savedValue = localStorage.getItem(id);
                if (savedValue) document.getElementById(id).value = savedValue;
            });
            ['sig1', 'sig2', 'sig3'].forEach(setupCanvas);
        });

        inputIds.forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                localStorage.setItem(id, e.target.value);
            });
        });

        // --- 2. IMAGE UPLOAD & MANIPULATION ---
        const imageInput = document.getElementById('poster-upload');
        const imagePreview = document.getElementById('poster-preview');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const imgControls = document.getElementById('img-controls');
        const changeImgBtn = document.getElementById('change-img-btn');
        const zoomSlider = document.getElementById('zoom-slider');
        const dragHint = document.getElementById('drag-hint');
        const dropZone = document.getElementById('image-drop-zone');

        // Image State
        let imgState = {
            scale: 1,
            panning: false,
            pointX: 0,
            pointY: 0,
            startX: 0,
            startY: 0
        };

        // Reset State helper
        function resetImageState() {
            imgState = { scale: 1, panning: false, pointX: 0, pointY: 0, startX: 0, startY: 0 };
            zoomSlider.value = 1;
            updateTransform();
        }

        // Apply CSS Transform
        function updateTransform() {
            imagePreview.style.transform = `translate(${imgState.pointX}px, ${imgState.pointY}px) scale(${imgState.scale})`;
        }

        // Handle File Select
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    
                    // UI Transitions
                    imagePreview.classList.remove('hidden');
                    uploadPlaceholder.classList.add('hidden');
                    imgControls.classList.remove('hidden');
                    imgControls.classList.add('flex');
                    dragHint.classList.remove('hidden');
                    
                    // IMPORTANT: Hide the input so it doesn't block mouse events on the image
                    imageInput.classList.add('hidden');
                    
                    resetImageState();
                }
                reader.readAsDataURL(file);
            }
        });

        // Handle Change Button
        changeImgBtn.addEventListener('click', () => {
            // Trigger the hidden input
            imageInput.click();
        });

        // Handle Zoom Slider
        zoomSlider.addEventListener('input', (e) => {
            imgState.scale = parseFloat(e.target.value);
            updateTransform();
        });

        // --- DRAG / PAN LOGIC ---
        
        function startPan(e) {
            // FIX: Only allow panning if image is loaded/visible.
            // This prevents preventingDefault behavior on the empty upload zone.
            if (imagePreview.classList.contains('hidden')) {
                return; 
            }

            e.preventDefault(); // Prevent scrolling on touch
            imgState.panning = true;
            imgState.startX = (e.touches ? e.touches[0].clientX : e.clientX) - imgState.pointX;
            imgState.startY = (e.touches ? e.touches[0].clientY : e.clientY) - imgState.pointY;
            imagePreview.classList.add('cursor-grabbing');
        }

        function pan(e) {
            if (!imgState.panning) return;
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            imgState.pointX = clientX - imgState.startX;
            imgState.pointY = clientY - imgState.startY;
            updateTransform();
        }

        function endPan() {
            imgState.panning = false;
            imagePreview.classList.remove('cursor-grabbing');
        }

        // Attach listeners to the DROPZONE or IMAGE
        // We attach to dropZone to catch events slightly outside the image if it shrunk
        dropZone.addEventListener('mousedown', startPan);
        dropZone.addEventListener('touchstart', startPan, { passive: false });

        window.addEventListener('mousemove', pan);
        window.addEventListener('touchmove', pan, { passive: false });

        window.addEventListener('mouseup', endPan);
        window.addEventListener('touchend', endPan);


        // --- 3. SIGNATURE CANVAS LOGIC ---
        function setupCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return; 
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0; 
            let lastY = 0;

            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#1e293b';

            function getPos(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                let clientX = e.touches ? e.touches[0].clientX : e.clientX;
                let clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
            }

            function startDraw(e) {
                isDrawing = true;
                const pos = getPos(e);
                lastX = pos.x; lastY = pos.y;
            }

            function draw(e) {
                if (!isDrawing) return;
                if(e.type === 'touchmove') e.preventDefault();
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                lastX = pos.x; lastY = pos.y;
            }

            function endDraw() { isDrawing = false; }

            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', endDraw);
            canvas.addEventListener('mouseout', endDraw);
            canvas.addEventListener('touchstart', startDraw, { passive: false });
            canvas.addEventListener('touchmove', draw, { passive: false });
            canvas.addEventListener('touchend', endDraw);
        }

        window.clearPad = function(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // --- 4. PREVIEW & DOWNLOAD ---
        const previewBtn = document.getElementById('preview-btn');
        const saveFinalBtn = document.getElementById('save-final-btn');
        const previewModal = document.getElementById('preview-modal');
        const finalPreviewImg = document.getElementById('final-preview-img');
        const cardArea = document.getElementById('manifesto-card');

        // Close Modal Helper
        window.closePreview = function() {
            previewModal.classList.add('hidden');
        }

        previewBtn.addEventListener('click', () => {
            const originalText = previewBtn.innerHTML;
            previewBtn.innerHTML = "Generating Preview...";
            previewBtn.disabled = true;

            // Hide UI elements that shouldn't appear in the PDF
            dragHint.classList.add('opacity-0');
            imgControls.classList.add('opacity-0');

            // --- KEY FIX FOR RESPONSIVE IMAGE FRAMING ---
            // Calculate scale ratio between current view (e.g. Mobile) and Target A4 (1123px)
            const currentWidth = cardArea.offsetWidth;
            const targetWidth = 1123;
            const scaleRatio = targetWidth / currentWidth;

            html2canvas(cardArea, {
                scale: 2, 
                useCORS: true, 
                backgroundColor: '#ffffff',
                logging: false,
                windowWidth: 1123, 
                windowHeight: 794,
                onclone: (clonedDoc) => {
                    const clonedCard = clonedDoc.getElementById('manifesto-card');
                    if(clonedCard) {
                        clonedCard.style.width = '1123px';
                        clonedCard.style.height = '794px';
                        clonedCard.style.maxWidth = 'none';
                        clonedCard.style.minHeight = 'none';
                        clonedCard.style.aspectRatio = 'auto';
                    }
                    
                    // SCALE THE IMAGE POSITION
                    const clonedImg = clonedDoc.getElementById('poster-preview');
                    if (clonedImg && !clonedImg.classList.contains('hidden')) {
                         // Scale the translation values so the image moves proportionally
                        const newX = imgState.pointX * scaleRatio;
                        const newY = imgState.pointY * scaleRatio;
                        clonedImg.style.transform = `translate(${newX}px, ${newY}px) scale(${imgState.scale})`;
                    }

                    const inputs = ['input-rule1', 'input-rule2', 'input-rule3', 'input-rule4', 'input-company'];
                    inputs.forEach(id => {
                        const original = document.getElementById(id);
                        const clone = clonedDoc.getElementById(id);
                        if(original && clone) clone.value = original.value;
                    });
                }
            }).then(canvas => {
                // Restore UI elements in the real DOM
                dragHint.classList.remove('opacity-0');
                imgControls.classList.remove('opacity-0');
                previewBtn.innerHTML = originalText;
                previewBtn.disabled = false;

                // Show in Modal
                const dataUrl = canvas.toDataURL('image/png');
                finalPreviewImg.src = dataUrl;
                previewModal.classList.remove('hidden');

                // Helper to convert Data URL to Blob for native iOS sharing
                function dataURItoBlob(dataURI) {
                    const byteString = atob(dataURI.split(',')[1]);
                    const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
                    const ab = new ArrayBuffer(byteString.length);
                    const ia = new Uint8Array(ab);
                    for (let i = 0; i < byteString.length; i++) {
                        ia[i] = byteString.charCodeAt(i);
                    }
                    return new Blob([ab], {type: mimeString});
                }

                // Set up the final save button
                saveFinalBtn.onclick = async () => {
                    const fileName = `manifesto-landscape-${Date.now()}.png`;
                    try {
                        const blob = dataURItoBlob(dataUrl);
                        const file = new File([blob], fileName, { type: 'image/png' });

                        // Try Native Web Share API (Brings up iOS Share Sheet with "Save Image")
                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                            await navigator.share({
                                files: [file],
                                title: 'Start-Up Manifesto',
                            });
                        } else {
                            // Fallback for Desktop/Android
                            const link = document.createElement('a');
                            link.download = fileName;
                            link.href = dataUrl;
                            link.click();
                        }
                    } catch (error) {
                        console.log('Share failed or was cancelled.', error);
                        // Final fallback just in case
                        const link = document.createElement('a');
                        link.download = fileName;
                        link.href = dataUrl;
                        link.click();
                    }
                };

            }).catch(err => {
                console.error(err);
                alert("Error generating image.");
                dragHint.classList.remove('opacity-0');
                imgControls.classList.remove('opacity-0');
                previewBtn.innerHTML = originalText;
                previewBtn.disabled = false;
            });
        });
    </script>
</body>
</html>
